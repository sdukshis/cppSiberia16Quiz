{
  "name": "C++ Siberia 2016 quiz",
  "tagline": "Тестовое задание на рефакторинг кода C++",
  "body": "## Тестовое задание на рефакторинг кода C++\r\n\r\nВ ходе разработки элемента текстового редактора на языке С++ программист решил использовать свои знания об семантике перемещений и написал код, приведённый ниже.\r\n\r\n```cpp\r\n#include <string>\r\n#include <list>\r\n#include <vector>\r\n#include <iostream>\r\n#include <iterator>\r\n#include <algorithm>\r\n#include <fstream>\r\n\r\nclass Text {\r\npublic:\r\n    Text() {\r\n        std::clog << __PRETTY_FUNCTION__ << '\\n';\r\n    }\r\n\r\n    Text(const Text& other)\r\n        : lines{other.lines} {\r\n        std::clog << __PRETTY_FUNCTION__ << '\\n';\r\n    }\r\n\r\n    Text(Text&& other)\r\n        : lines{other.lines} {\r\n        std::clog << __PRETTY_FUNCTION__ << '\\n';\r\n    }\r\n\r\n    Text& operator=(const Text& other) {\r\n        std::clog << __PRETTY_FUNCTION__ << '\\n';\r\n        lines = other.lines;\r\n        return *this;\r\n    }\r\n\r\n    Text& operator=(Text&& other) {\r\n        std::clog << __PRETTY_FUNCTION__ << '\\n';\r\n        lines = other.lines;\r\n        return *this;\r\n    }\r\n\r\n    friend std::istream& operator>>(std::istream& stream, Text& text) {\r\n        text.lines.clear();\r\n        std::string line;\r\n        while (!std::getline(stream, line).eof()) {\r\n            text.lines.emplace_back(std::move(line));\r\n        }\r\n        return stream;\r\n    }\r\n\r\n    friend std::ostream& operator<<(std::ostream& stream, const Text& text) {\r\n        std::copy(text.lines.begin(), text.lines.end(),\r\n                  std::ostream_iterator<std::string>(stream, \"\\n\"));\r\n        return stream;\r\n    }\r\n\r\nprivate:\r\n    std::list<std::string> lines;\r\n};\r\n\r\nint main(int argc, const char* argv[]) {\r\n    std::vector<Text> sources;\r\n    Text text;\r\n    for (int i = 1; i < argc; ++i) {\r\n        std::ifstream{argv[i]} >> text;\r\n        sources.push_back(text);\r\n    }\r\n\r\n    return 0;\r\n}\r\n```\r\n\r\nПри попытке выполнить эту программу с четырьмя аргументами он получил в ответ неожиданый результат.\r\n```\r\nText::Text()\r\nText::Text(const Text &)\r\nText::Text(const Text &)\r\nText::Text(const Text &)\r\nText::Text(const Text &)\r\nText::Text(const Text &)\r\nText::Text(const Text &)\r\nText::Text(const Text &)\r\n```\r\n\r\nЕго конструктор перемещения не был вызван ни один раз.\r\n\r\n**Задание:** объясните почему компилятор не использовал конструктор перемещения и предложите изменения в исходном коде, которые позволят исправить эту ситуацию.\r\n\r\nВаши решения присылайте на адрес Pavel.Filonov@kaspersky.com",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}